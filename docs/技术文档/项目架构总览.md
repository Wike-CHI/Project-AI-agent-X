# 项目架构总览

## 1. 系统架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                        客户端层                                       │
│         (React Native / Flutter / Web)                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌───────────────────────────────────────────────────────────────┐ │
│  │                      API 网关层                                │ │
│  │               (FastAPI + 认证 + 日志 + 流式)                    │ │
│  └───────────────────────────────────────────────────────────────┘ │
│                              │                                      │
├──────────────────────────────┼──────────────────────────────────────┤
│                              ▼                                      │
│  ┌───────────────────────────────────────────────────────────────┐ │
│  │                    智能体服务层                                 │ │
│  │  ┌─────────────────────────────────────────────────────────┐  │ │
│  │  │                  CrewAI 核心                             │  │ │
│  │  │  - Orchestrator (核心调度者)                             │  │ │
│  │  │  - Emotion Companion (情绪伴侣)                          │  │ │
│  │  │  - Schedule Manager (日程管家)                           │  │ │
│  │  │  - Information Filler (信息补齐)                         │  │ │
│  │  └─────────────────────────────────────────────────────────┘  │ │
│  └───────────────────────────────────────────────────────────────┘ │
│                              │                                      │
├──────────────────────────────┼──────────────────────────────────────┤
│                              ▼                                      │
│  ┌───────────────────────────────────────────────────────────────┐ │
│  │                    知识处理层                                   │ │
│  │  ┌─────────────────────────────────────────────────────────┐  │ │
│  │  │               LlamaIndex RAG                             │  │ │
│  │  │  - 文档加载与处理                                          │  │ │
│  │  │  - 索引构建 (向量索引 + 树形索引)                          │  │ │
│  │  │  - 检索与重排序                                           │  │ │
│  │  │  - 上下文构建                                             │  │ │
│  │  └─────────────────────────────────────────────────────────┘  │ │
│  └───────────────────────────────────────────────────────────────┘ │
│                              │                                      │
├──────────────────────────────┼──────────────────────────────────────┤
│                              ▼                                      │
│  ┌───────────────────────────────────────────────────────────────┐ │
│  │                    记忆存储层                                   │ │
│  │  ┌────────────┐ ┌────────────┐ ┌────────────┐                │ │
│  │  │ Qdrant     │ │ Neo4j      │ │ SQLite     │                │ │
│  │  │ (语义记忆)  │ │ (情景记忆)  │ │ (关系记忆)  │                │ │
│  │  └────────────┘ └────────────┘ └────────────┘                │ │
│  └───────────────────────────────────────────────────────────────┘ │
│                              │                                      │
├──────────────────────────────┼──────────────────────────────────────┤
│                              ▼                                      │
│  ┌───────────────────────────────────────────────────────────────┐ │
│  │                    本地推理层                                   │ │
│  │            Qwen 2.5 3B (Q4量化) / Ollama                        │ │
│  └───────────────────────────────────────────────────────────────┘ │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

## 2. 技术栈总结

| 层次 | 技术 | 用途 |
|-----|------|-----|
| **API 框架** | FastAPI | RESTful API 服务 |
| **智能体框架** | CrewAI | 多智能体协作 |
| **RAG 框架** | LlamaIndex | 知识检索增强 |
| **向量数据库** | Qdrant | 语义记忆存储 |
| **图数据库** | Neo4j | 情景记忆存储 |
| **关系数据库** | SQLite | 用户配置存储 |
| **LLM** | Qwen 2.5 3B | 本地推理 |
| **嵌入模型** | BAAI/bge-small-zh | 向量化 |
| **配置管理** | Pydantic Settings | 环境配置 |

## 3. 项目目录结构

```
Project-AI-agent-X/
├── .claude/                  # Claude Code 配置
├── .git/                     # Git 仓库
├── .gitignore
├── README.md
│
├── backend/                  # 后端服务
│   ├── pyproject.toml        # Python 项目配置
│   ├── README.md
│   └── src/
│       └── pdns/
│           ├── __init__.py
│           ├── config/       # 配置模块
│           │   ├── __init__.py
│           │   ├── settings.py
│           │   └── llm_config.py
│           ├── agents/       # 智能体模块
│           │   ├── __init__.py
│           │   ├── base.py
│           │   ├── orchestrator.py
│           │   ├── emotion_companion.py
│           │   ├── schedule_manager.py
│           │   └── information_filler.py
│           ├── crews/        # 团队模块
│           │   ├── __init__.py
│           │   ├── main_crew.py
│           │   └── crew_config.py
│           ├── memory/       # 记忆模块
│           │   ├── __init__.py
│           │   ├── models.py
│           │   ├── vector_store.py
│           │   ├── graph_store.py
│           │   ├── relational_store.py
│           │   ├── manager.py
│           │   └── embedding.py
│           ├── rag/          # RAG 模块
│           │   ├── __init__.py
│           │   ├── manager.py
│           │   ├── loaders.py
│           │   ├── indices.py
│           │   ├── retriever.py
│           │   └── context.py
│           ├── api/          # API 模块
│           │   ├── __init__.py
│           │   ├── main.py
│           │   ├── routes/
│           │   │   ├── __init__.py
│           │   │   ├── health.py
│           │   │   ├── agents.py
│           │   │   ├── memories.py
│           │   │   └── users.py
│           │   ├── models/
│           │   │   ├── __init__.py
│           │   │   ├── request.py
│           │   │   └── response.py
│           │   └── middleware/
│           │       ├── __init__.py
│           │       ├── auth.py
│           │       └── logging.py
│           └── utils/        # 工具模块
│               ├── __init__.py
│               ├── logging.py
│               └── async_utils.py
│
├── data/                     # 数据目录
│   ├── memory/
│   │   ├── qdrant/          # Qdrant 存储
│   │   ├── neo4j/           # Neo4j 数据
│   │   └── relational.db    # SQLite 数据库
│   ├── documents/           # 文档存储
│   └── embeddings/          # 嵌入模型缓存
│
├── frontend/                 # 前端应用 (待开发)
│   └── src/
│
├── prototype/               # 原型设计 (待开发)
│   └── ...
│
└── docs/                    # 文档目录
    ├── 产品文档/
    │   └── AI伴侣应用产品技术规划与选型.md
    └── 技术文档/
        ├── CrewAI多智能体架构设计.md
        ├── 记忆存储系统设计.md
        ├── RAG数据处理系统设计.md
        ├── API接口设计.md
        └── 项目架构总览.md
```

## 4. 开发路线图

### Phase 1: 基础架构 (Week 1-2)
- [ ] 项目初始化与配置
- [ ] CrewAI 智能体框架实现
- [ ] 基础 API 服务

### Phase 2: 记忆系统 (Week 3-4)
- [ ] Qdrant 向量数据库集成
- [ ] Neo4j 图数据库集成
- [ ] 统一记忆管理器

### Phase 3: 知识处理 (Week 5-6)
- [ ] LlamaIndex RAG 实现
- [ ] 文档加载与索引构建
- [ ] 检索与上下文增强

### Phase 4: 高级功能 (Week 7-8)
- [ ] 主动智能引擎
- [ ] 情感计算模块
- [ ] 前端界面开发
